@model StockListViewModel
@{
    ViewData["Title"] = "Stock Levels";
}

<div class="card">
    <div class="card-header">
        <form method="get" action="/stock" class="filter-bar"
              hx-get="/stock"
              hx-target="#list-container"
              hx-swap="innerHTML"
              hx-push-url="true"
              hx-trigger="submit, change from:select">
            <div class="search-input-wrapper">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="9" r="6"/>
                    <path d="M13 13L17 17"/>
                </svg>
                <input type="text" 
                       name="search" 
                       value="@Model.Stocks.Search" 
                       class="form-control" 
                       placeholder="Search products, locations..."
                       hx-get="/stock"
                       hx-target="#list-container"
                       hx-swap="innerHTML"
                       hx-push-url="true"
                       hx-trigger="input changed delay:300ms, search"
                       hx-include="[name='locationId']" />
                @if (!string.IsNullOrEmpty(Model.Stocks.Search))
                {
                    <button type="button" class="clear-search" onclick="this.previousElementSibling.value=''; this.previousElementSibling.dispatchEvent(new Event('input'));">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4L12 12M12 4L4 12"/>
                        </svg>
                    </button>
                }
            </div>
            <select name="locationId" class="form-control" style="width: 220px;">
                <option value="">All Locations</option>
                @foreach (var loc in Model.Locations)
                {
                    <option value="@loc.Id" selected="@(Model.LocationId == loc.Id)">@loc.Code - @loc.Name</option>
                }
            </select>
            <span class="htmx-indicator">
                <span class="spinner"></span>
            </span>
        </form>
        <span class="text-muted text-sm">@Model.Stocks.TotalItems items</span>
    </div>
    
    <div id="list-container">
        @await Html.PartialAsync("_StockList", Model)
    </div>
</div>
