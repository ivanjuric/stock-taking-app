@model StockTakingPerformViewModel
@{
    ViewData["Title"] = $"Count Stock - {Model.LocationName}";
}

<div class="mb-lg flex justify-between items-center">
    <a asp-action="Details" asp-route-id="@Model.Id" class="text-sm text-muted">&larr; Back to Details</a>
    @await Html.PartialAsync("_CountProgress", Model)
</div>

<div class="card">
    <div class="card-header" id="card-header-section">
        <div>
            <h3 class="card-title">@Model.LocationName</h3>
            <p class="text-sm text-muted">Location: @Model.LocationCode</p>
        </div>
        @if (Model.CountedItems == Model.TotalItems)
        {
            <form asp-action="Complete" asp-route-id="@Model.Id" method="post">
                <button type="submit" class="btn btn-success btn-lg">Complete Stock Taking</button>
            </form>
        }
    </div>
    
    <div class="card-body">
        <div id="item-list">
            @foreach (var item in Model.Items)
            {
                @await Html.PartialAsync("_CountItemRow", item)
            }
        </div>
    </div>

    @if (Model.CountedItems < Model.TotalItems)
    {
        <div class="card-footer">
            <p class="text-sm text-muted text-center">
                Count each item and click Save. Progress is saved automatically.
            </p>
        </div>
    }
</div>

@if (Model.CountedItems == Model.TotalItems)
{
    <div class="card mt-lg" style="border-color: var(--color-success);">
        <div class="card-body text-center">
            <h3 class="font-semibold text-success mb-sm">All Items Counted!</h3>
            <p class="text-muted mb-md">Click the button above to complete this stock taking and notify the admin for review.</p>
        </div>
    </div>
}
