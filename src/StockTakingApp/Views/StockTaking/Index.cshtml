@model StockTakingIndexViewModel
@using StockTakingApp.Models.Enums
@{
    ViewData["Title"] = "Stock Taking";
    var isAdmin = User.IsInRole("Admin");
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Stock Taking Sessions</h3>
        @if (isAdmin)
        {
            <a asp-action="Create" class="btn btn-primary">+ New Stock Taking</a>
        }
    </div>
    
    <div class="filter-bar">
        <div class="search-input-wrapper">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="7" cy="7" r="5"/>
                <path d="M11 11L14 14"/>
            </svg>
            <input type="text" 
                   name="search" 
                   class="form-control search-input" 
                   placeholder="Search by location or worker..."
                   value="@Model.StockTakings.Search"
                   hx-get="/stocktaking"
                   hx-target="#list-container"
                   hx-swap="innerHTML"
                   hx-push-url="true"
                   hx-trigger="input changed delay:300ms, search"
                   hx-include="[name='status']" />
        </div>
        <select name="status" 
                class="form-control"
                hx-get="/stocktaking"
                hx-target="#list-container"
                hx-swap="innerHTML"
                hx-push-url="true"
                hx-include="[name='search']">
            <option value="">All Statuses</option>
            <option value="@StockTakingStatus.Requested" selected="@(Model.StatusFilter == StockTakingStatus.Requested)">Requested</option>
            <option value="@StockTakingStatus.InProgress" selected="@(Model.StatusFilter == StockTakingStatus.InProgress)">In Progress</option>
            <option value="@StockTakingStatus.Completed" selected="@(Model.StatusFilter == StockTakingStatus.Completed)">Completed</option>
        </select>
    </div>
    
    <div id="list-container">
        @await Html.PartialAsync("_StockTakingList", Model)
    </div>
</div>
