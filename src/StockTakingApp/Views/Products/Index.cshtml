@model ProductListViewModel
@{
    ViewData["Title"] = "Products";
}

<div class="card">
    <div class="card-header">
        <form method="get" action="/products" class="filter-bar"
              hx-get="/products"
              hx-target="#list-container"
              hx-swap="innerHTML"
              hx-push-url="true"
              hx-trigger="submit, change from:select">
            <div class="search-input-wrapper">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="9" r="6"/>
                    <path d="M13 13L17 17"/>
                </svg>
                <input type="text" 
                       name="search" 
                       value="@Model.Products.Search" 
                       class="form-control" 
                       placeholder="Search by name, SKU..."
                       hx-get="/products"
                       hx-target="#list-container"
                       hx-swap="innerHTML"
                       hx-push-url="true"
                       hx-trigger="input changed delay:300ms, search" />
                @if (!string.IsNullOrEmpty(Model.Products.Search))
                {
                    <button type="button" class="clear-search" onclick="this.previousElementSibling.value=''; this.previousElementSibling.dispatchEvent(new Event('input'));">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4L12 12M12 4L4 12"/>
                        </svg>
                    </button>
                }
            </div>
            <select name="category" class="form-control">
                <option value="">All Categories</option>
                @foreach (var cat in Model.Categories)
                {
                    <option value="@cat" selected="@(Model.CategoryFilter == cat)">@cat</option>
                }
            </select>
            <span class="htmx-indicator">
                <span class="spinner"></span>
            </span>
        </form>
        <a asp-action="Create" class="btn btn-primary">
            + Add Product
        </a>
    </div>
    
    <div id="list-container">
        @await Html.PartialAsync("_ProductList", Model)
    </div>
</div>
